# Define the platform we are working with
platform :ios do

  # Define the lane. This is the workflow we run: 'fastlane try_it'
  desc "Runs a test action that increments the project's build number."
  lane :try_it do
    UI.message "--- Starting 'try_it' Lane ---"

    # =========================================================
    # ACTION: increment_build_number
    # Purpose: Updates the CFBundleVersion (Build Number) in the
    # project file, which is a local operation.
    # =========================================================

    # We use a unique timestamp as the build number so the change is easy to confirm.
    # Fastlane will automatically find and modify the .xcodeproj file.
    UI.message "Reading current build number and preparing to update..."

    # The action performs the modification
    new_build_number = Time.now.to_i.to_s
    
    increment_build_number(
        build_number: new_build_number,
        # Set to true to print out more details about the file modification
        verbose: true
    )

    # =========================================================
    # ACTION: get_build_number (Used to confirm the change)
    # =========================================================
    
    current_build_number = get_build_number

    UI.success "ðŸŽ‰ Action Complete! The build number was successfully set."
    UI.success "New Build Number: #{current_build_number}"
    UI.message "Check the project's 'Info.plist' or 'project.pbxproj' to see the change."
  end

end

